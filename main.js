(()=>{"use strict";function e(e,t,n){var o=e.cardTemplate.cloneNode(!0),r=o.querySelector(".card__image"),c=o.querySelector(".card__like-button");return r.src=e.imgSrc,r.alt=e.description|e.title,o.querySelector(".card__title").textContent=e.title,n.currentUser===n.cardOwner?o.querySelector(".card__delete-button").addEventListener("click",t.removeFunction):o.querySelector(".card__delete-button").remove(),Object.values(e.likes).some((function(e){return e._id===n.currentUser}))&&c.classList.add("card__like-button_is-active"),c.addEventListener("click",t.likeFunction),o.querySelector(".card__like-number").textContent=e.likes.length,o.querySelector(".card").setAttribute("data-id",e.id),r.addEventListener("click",(function(){return t.openFunction(e.imgSrc,e.title)})),o}function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t&&t(),e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}function r(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;t.addEventListener("submit",(function(r){r.preventDefault(),o&&o(),n(e),t.reset()}))}function c(e,t){e.some((function(e){return!e.validity.valid}))?t.setAttribute("disabled",!0):t.removeAttribute("disabled")}function i(e,t){if(e){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.classList.remove(t.inputErrorClass),e.querySelector(".".concat(r.id,"-error")).classList.remove(t.errorClass),c(n,o)}))}}var a={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-29",headers:{authorization:"2630d1a1-9682-4616-a095-b5906122210f","Content-type":"application/json"}};function u(){return fetch(a.baseUrl+"/users/me",{method:"GET",headers:{authorization:a.headers.authorization}}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}function s(e){var t=e.target.closest(".card");fetch(a.baseUrl+"/cards/".concat(t.dataset.id),{method:"DELETE",headers:{authorization:a.headers.authorization}}).then((function(e){e.ok?t.remove():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}function l(e,t,n){fetch(a.baseUrl+"/cards/likes/".concat(e.dataset.id),{method:n,headers:{authorization:a.headers.authorization}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(n){t.classList.toggle("card__like-button_is-active"),e.querySelector(".card__like-number").textContent=n.likes.length})).catch((function(e){return console.log(e)}))}function d(e){var t=e.target.closest(".card");e.target.classList.contains("card__like-button_is-active")?l(t,e.target,"DELETE"):l(t,e.target,"PUT")}function p(e,t){t.textContent=e?"Сохранение...":"Сохранить"}var m,f={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup__close")|t.target.classList.contains("popup_is-opened")&&(n(e),i(e.querySelector(f.formSelector),f))}))})),m=f,Array.from(document.querySelectorAll(m.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){var i,a;i={element:r,class:t.inputErrorClass},a={element:e.querySelector(".".concat(r.id,"-error")),class:t.errorClass},i.element.validity.valid?function(e,t){e.element.classList.remove(e.class),t.element.classList.remove(t.class),t.element.textContent=""}(i,a):function(e,t){e.element.classList.add(e.class),e.element.validity.patternMismatch?t.element.textContent=e.element.dataset.errorMessage:t.element.textContent=e.element.validationMessage,t.element.classList.add(t.class)}(i,a),c(n,o)}))}))}(e,m)}));var _=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup_type_edit"),v=document.querySelector(".profile__title"),y=document.querySelector(".profile__description"),S=document.forms["edit-profile"],b=h.querySelector(".popup__button");r(h,S,(function(){var e,t;p(!0,b),(e=S.name.value,t=S.description.value,fetch(a.baseUrl+"/users/me",{method:"PATCH",headers:a.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){e?(v.textContent=e.name,y.textContent=e.about):Promise.reject("Ошибка")})).catch((function(e){return console.log(e)})).finally((function(){return p(!1,b)}))})),_.addEventListener("click",(function(e){t(h,(function(){S.name.value=v.textContent,S.description.value=y.textContent,i(S,f)}))}));var g=document.querySelector("#card-template").content,k=document.querySelector(".places__list"),q=document.querySelector(".popup_type_image"),E=q.querySelector(".popup__image"),L=q.querySelector(".popup__caption");function C(e,n){E.src=e,E.alt=n,L.textContent=n,t(q)}var j=document.querySelector(".popup_type_new-card"),P=document.querySelector(".profile__add-button"),x=document.forms["new-place"],A=j.querySelector(".popup__button");r(j,x,(function(){var t,n;p(!0,A),(t=x["place-name"].value,n=x.link.value,fetch(a.baseUrl+"/cards",{method:"POST",headers:a.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(t){t?u().then((function(n){k.prepend(e({cardTemplate:g,imgSrc:t.link,title:t.name,likes:t.likes,id:t._id},{removeFunction:s,likeFunction:d,openFunction:C},{cardOwner:t.owner._id,currentUser:n._id}))})):Promise.reject("Ошибка")})).catch((function(e){return console.log(e)})).finally((function(){return p(!1,A)}))})),P.addEventListener("click",(function(e){i(x,f),t(j)}));var U=document.querySelector(".popup_edit_avatar"),w=document.querySelector(".profile__image"),T=document.forms["edit-avatar"],z=U.querySelector(".popup__button");w.addEventListener("click",(function(e){t(U,(function(){i(T,f)}))})),r(U,T,(function(){var e;p(!0,z),(e=T.avatar.value,fetch(a.baseUrl+"/users/me/avatar",{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))).then((function(e){e?w.setAttribute("style","background-image: url(".concat(e.avatar,");")):Promise.reject("Ошибка")})).catch((function(e){return console.log(e)})).finally((function(){return p(!1,z)}))})),Promise.all([u(),fetch(a.baseUrl+"/cards",{method:"GET",headers:{authorization:a.headers.authorization}}).then((function(e){return e.ok?e:Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))]).then((function(e){return e})).then((function(e){return{userInfo:e[0].json(),cardsInfo:e[1].json()}})).then((function(t){t.userInfo.then((function(n){v.textContent=n.name,y.textContent=n.about,w.setAttribute("style","background-image: url(".concat(n.avatar,");")),t.cardsInfo.then((function(t){t.forEach((function(t){k.prepend(e({cardTemplate:g,imgSrc:t.link,title:t.name,description:t.description,likes:t.likes,id:t._id},{removeFunction:s,likeFunction:d,openFunction:C},{cardOwner:t.owner._id,currentUser:n._id}))}))}))}))}))})();